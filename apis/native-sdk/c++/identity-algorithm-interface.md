---
description: Identity Algorithm (Asymmetric Encryption Algorithm) Interface
---

# Identity Algorithm Interface

The EDFS-SDK library uses the ECC256 elliptic curve encryption algorithm by default as the asymmetric encryption algorithm in the electronic envelope mode. The selected curve is the standard SECP256K1 parameter. The detailed parameters are as follows:

_**prime**：FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F_

_**A**：0000000000000000000000000000000000000000000000000000000000000000_

_**B**：0000000000000000000000000000000000000000000000000000000000000007_

_**order**：FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141_

_**Gx**：79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798_

_**Gy**：483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8_

### Create an Identity Object

Generate (issue) an identity object

```
INT32 TSK_IdentityIssue(IdentityObject * pIdentity, BYTE* pSeed, UINT32 nSeedLen);
```

<details>

<summary>Parameters</summary>

* IdentityObject \*
  * pIdentity - The obtained identity object (opaque semantics) \[OUT]
* CHAR \*
  * pSeed - The seed information of the specified identity key information \[IN]
* UINT32
  * nSeedLen - The length of the seed information of the specified identity key information, in bytes \[IN]

</details>

<details>

<summary>Return Values</summary>

* INT32
  * KError\_Success success
  * KError\_Other, failed, other errors

</details>

{% hint style="info" %}
The identity object is an opaque object entity, and the outside does not need to know its internal composition.&#x20;

Only supports ECC 256K1 identity If the seed information is specified externally, the generated identity information will be consistent, and the seed information is mandatory to be 32 bytes in length. The outside can use a fixed seed information for the identity of the same user through a specific algorithm design, and the user identity generated by calling the method identity interface multiple times will be fixed to support the distributed program design and development process.&#x20;

The identity key information of the user is always stored only in the device trusted by the user. Only the public key corresponding to the identity key is disclosed to the public to realize the secure encrypted digital file sharing function based on the EDFS protocol.
{% endhint %}

### Create an Identity Object (External)

Generate (issue) an identity object and directly return a keystream form of the results

```
INT32 TSK_IdentityIssueEx(BYTE* pSeed, UINT32 nSeedLen,BYTE* pPublicKeyBuf, UINT32& nPublicKeyLen,BYTE* pPrivateKenBuf, UINT32& nPrivateKeyLen,BYTE* pKeyID);
```

<details>

<summary>Parameters</summary>

* CHAR \*
  * pSeed - The seed information of the specified identity key information \[IN]
* UINT32
  * nSeedLen - The length of the seed information of the specified identity key information, in bytes \[IN]
* CHAR \*
  * pPublicKeyBuf - identity public key information data stream \[IN/OUT]
* UINT32 &&#x20;
  * nPublicKeyLen - The length of the external public key buffer \[IN/OUT]
* CHAR \*
  * pPrivateKeyBuf - identity private key information data stream \[IN/OUT]
* UINT32 &
  * nPrivateKeyLen - The length of the private key buffer passed in from the outside \[IN/OUT]
* CHAR \*
  * pKeyID - identity key ID, fixed 20 bytes \[IN/OUT]

</details>

<details>

<summary>Return Values</summary>

* INT32
  * KError\_Success success
  * KError\_Other, failed, other errors;

</details>

{% hint style="info" %}
The function of TSK\_IdentityIssueEx is the same as that of TSK\_IdentityIssue. The difference is that it returns the binary stream of public and private keys that can be directly parsed and saved externally. Externally, the TSK\_IdentityIssueEx interface can be used to obtain the public and private key data of the identity key and save it directly or do other processing. In the design of the EDFS-SDK library, the buffer memory is prepared in advance by the external program, and is passed to the EDFS-SDK library together with the buffer length information. The EDFS-SDK library operates directly on the externally prepared buffer. , the release of the buffer is also the responsibility of the external program itself.
{% endhint %}

### Release an Identity Object

Release an identity object.

```
INT32 TSK_IdentityFree(IdentityObject identity);
```

<details>

<summary>Parameters</summary>

* IdentityObject
  * identity - the identity object to release (opaque semantics) \[IN]

</details>

<details>

<summary>Return Values</summary>

* INT32
  * KError\_Success success

</details>

{% hint style="info" %}
Corresponding to the TSK\_IdentityIssue function, an opaque semantic user identity is generated externally through the TSK\_IdentityIssue function. After use, the Free interface needs to be called to release the memory space occupied by the opaque semantic user identity object, following the principle of whoever applies, whoever releases.
{% endhint %}

### Export an Identity Object

Export an identity object in binary form according to the specified nAction(public or private key).

```
INT32 TSK_IdentityExport(IdentityObject identity, BYTE nAction, UINT32 BufLen, BYTE * Buf, UINT32 * pWrittenLen);
```

<details>

<summary>Parameters</summary>

* IdentityObject
  * identity - the target identity object (opaque semantics) \[IN]
* Byte
  * nAction - the action selection: \[IN]&#x20;
    * 1 means public key,&#x20;
    * 2 means private key,&#x20;
    * 3 means key identity ID
* UINT32
  * BufLen - the receive buffer size of the data to output \[IN]
* CHAR \*
  * Buf - the receive buffer of the data to be output \[OUT]
* UINT32 \*
  * pWrittenLen - the size of the actual output data returned \[IN/OUT]

</details>

<details>

<summary>Return Values</summary>

* INT32
  * KError\_Success success
  * KError\_Other, other errors, usually memory allocation errors (or insufficient buffers)

</details>

{% hint style="info" %}
Externally, the public key or private key corresponding to the identity can be exported from the specified user identity object with opaque semantics through the TSK\_IdentityExport interface. However, the prerequisite is that the opaque semantic object itself contains two kinds of information. According to the rules of the ECC encryption algorithm, if the identity object contains private key information, the binary stream data of the public key or private key can be arbitrarily derived. If the identity object only contains public key information, only the binary stream data of the public key can be exported.
{% endhint %}

### Import an Identity Object

Recover identity objects from reading information from data.

```
INT32 TSK_IdentityImport(BYTE Action,UINT32 BufLen,BYTE*Buf,IdentityObject*pIdentity);
```

<details>

<summary>Parameters</summary>

* CHAR
  * Action - the action selection: \[IN]&#x20;
    * 1 means public key
    * 2 means private key
* UINT32
  * BufLen - the externally prepared buffer size \[IN]
* CHAR \*
  * Buf - an externally prepared identity key binary stream data \[IN]
* IdentityObject \*
  * pIdentity - the restored identity object (opaque semantics) \[OUT]

</details>

<details>

<summary>Return Values</summary>

* INT32
  * KError\_Success success
  * KError\_Other, other errors, usually memory allocation errors (or insufficient buffers)

</details>

{% hint style="info" %}
Corresponding to the TSK\_IdentityExport interface, import the binary stream data of a key passed in from the outside and restore it to an identity object with opaque semantics.
{% endhint %}

### Encryption/Signing with Identity Object

Perform encryption and/or signing operations using identity objects.

```
INT32 TSK_IdentityEncrypt(IdentityObject identity, BYTE cryptAction, UINT32 nSrcFlowLen, BYTE * pSrcFlow, UINT32 nTarFlowLen, BYTE * pTarFlow, UINT32 * pTarFlowReturnLen);
```

<details>

<summary>Parameters</summary>

* IdentityObject
  * identity - the identity object to release (opaque semantics) \[IN]

</details>

<details>

<summary>Return Values</summary>

* INT32
  * KError\_Success success

</details>

{% hint style="info" %}
Corresponding to the TSK\_IdentityIssue function, an opaque semantic user identity is generated externally through the TSK\_IdentityIssue function. After use, the Free interface needs to be called to release the memory space occupied by the opaque semantic user identity object, following the principle of whoever applies, whoever releases.
{% endhint %}



### se an Identity Object

Release an identity object.

```
INT32 TSK_IdentityFree(IdentityObject identity);
```

<details>

<summary>Parameters</summary>

* IdentityObject
  * identity - the identity object to release (opaque semantics) \[IN]

</details>

<details>

<summary>Return Values</summary>

* INT32
  * KError\_Success success

</details>

{% hint style="info" %}
Corresponding to the TSK\_IdentityIssue function, an opaque semantic user identity is generated externally through the TSK\_IdentityIssue function. After use, the Free interface needs to be called to release the memory space occupied by the opaque semantic user identity object, following the principle of whoever applies, whoever releases.
{% endhint %}
